<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro</title>
    <link rel="stylesheet" href="css/cadastro.css">
</head>

<body>
    <div class="div_fechar_alerta" onclick="fechar_alerta()" style="display: none " id="div_fechar_alerta">
    </div>
    <div class="alerta_lofhel" style="display: none;" id="alerta_grupo3">
        <div>
            <img src="deshbord/imagens-deshbord/logotipo01.png" id="logotipo_alerta">
            <img src="deshbord/imagens-deshbord/exit.png" id="icone_fechar_alerta" alt="" onclick="fechar_alerta()">
        </div>
        <p id="alerta_titulo">
            Cadastro realizado com sucesso
        </p>


        <p id="alerta_sub"><a href="login.html">
                Faça o seu login</a>
        </p>


    </div>
    <div class="container">
        <div class="left-content">
            <div class="buttonback">
                <a href="inicio.html"><img src="assets/back button.png" alt="backbutton"></a>
            </div>
            <div class="position-logotipo">
                <a href="inicio.html"><img class="size-logotipo" src="assets/logotipo01.png" alt="logotipo01"></a>
            </div>
            <div class="title">
                <span class="size-title">
                    SEJA BEM-VINDO <br> _
                </span>
            </div>
            <div class="slogan">
                <span class="size-slogan">
                    Preservando a excelência do vinho<br> através da tecnologia
                </span>
            </div>
        </div>

        <div class="direita">
            <p class="titulo">Cadastre Sua Empresa</p>
            <div class="linha">
                <div></div>
                <div onclick="proximaEtapa()"></div>
                <div></div>
            </div>
            <!-- Etapa 1: Dados da Empresa -->
            <div class="content">
                <div class="etapa primeiro" style="display: noe;">
                    <!-- Nome Fantasia -->
                    <div>
                        <img src="assets/svg/user.svg" alt="">
                        <p id="texto_nome_fantasia">Nome Fantasia</p>
                    </div>
                    <input type="text" id="ipt_nome_fantasia" onclick="digitando_cad('nome_fantasia')">
                    <span id="erro_nome_fantasia" style="display: none;">Preencha o nome fantasia</span>

                    <!-- Razão Social -->
                    <div>
                        <img src="assets/svg/user.svg" alt="">
                        <p id="texto_razao_social">Razão Social</p>
                    </div>
                    <input type="text" id="ipt_razao_social" onclick="digitando_cad('razao_social')">
                    <span id="erro_razao_social" style="display: none;">Preencha a razão social</span>

                    <!-- CNPJ -->
                    <div>
                        <img src="assets/svg/user.svg" alt="">
                        <p id="texto_cnpj">CNPJ</p>
                    </div>
                    <input type="text" id="ipt_cnpj" onclick="digitando_cad('cnpj')">
                    <span id="erro_cnpj" style="display: none;">CNPJ inválido</span>

                    <button onclick="proximaEtapa()">PRÓXIMO</button>
                    <p id="subtitulo">Já possui uma conta?
                        <a href="login.html"> <span
                                style="color: #DEA976; text-decoration: underline; justify-self: center;">Acesse
                                aqui</span></a>
                    </p>
                </div>

                <!-- Etapa 2: Dados do Responsável -->
                <div class="etapa segundo" style="display: none;">

                    <div>
                        <img src="assets/svg/user.svg" alt="">
                        <p id="texto_nome">Nome do Responsável</p>
                    </div>
                    <input type="text" id="ipt_nome" onclick="digitando_cad('nome')">
                    <span id="erro_nome" style="display: none;">Preencha o nome</span>

                    <!-- Email -->
                    <div>
                        <img src="assets/svg/mail.svg" alt="">
                        <p id="texto_email">Email</p>
                    </div>
                    <input type="text" id="ipt_email" onclick="digitando_cad('email')">
                    <span id="erro_email" style="display: none;">E-mail inválido deve conter: 1(@) e 1(.)</span>

                    <!-- Telefone -->
                    <div>
                        <img src="assets/svg/mail.svg" alt="">
                        <p id="texto_telefone">Telefone</p>
                    </div>
                    <input type="text" id="ipt_telefone" onclick="digitando_cad('telefone')">
                    <span id="erro_telefone" style="display: none;">Telefone inválido (11 dígitos)</span>

                    <!-- Senha -->
                    <div>
                        <img src="assets/svg/lock-closed.svg" alt="">
                        <p id="texto_senha">Senha</p>
                    </div>
                    <input type="password" id="ipt_senha" onclick="digitando_cad('senha')" oninput="digitando_senha()">
                    <span id="erro_senha" style="display: none;">Senha inválida</span>

                    <!-- Confirmar Senha -->
                    <div>
                        <img src="assets/svg/lock-closed.svg" alt="">
                        <p id="texto_confirmar_senha">Confirmar Senha</p>
                    </div>
                    <input type="password" id="ipt_confirmar_senha" onclick="digitando_cad('confirmar_senha')">
                    <span id="erro_confirmar_senha" style="display: none;">As senhas não coincidem</span>
                    
                    <div id="recomendacao_senha">
                        <ul>
                            <li id="minusculo">Um caractere minúsculo </li>
                            <li id="maiusculo">Um caractere maiúsculo</li>
                            <li id="numero">Um número</li>
                        </ul>
                        <ul>
                            <li id="especial">Um caractere especial</li>
                            <li id="minimo">Mínimo de 8 caracteres</li>
                        </ul>
                    </div>
                    <button onclick="cadastrar()">CADASTRAR-SE</button>
                    <span id="campos_vazios" style="display: none;">campos_vazios</span>
                    <p id="subtitulo">Já possui uma conta?
                        <a href="login.html"><span style="color: #658a87; text-decoration: underline;">Acesse
                                aqui</span></a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function digitando_cad(x) {
            var texto_x = document.getElementById(`texto_${x}`);
            var ipt_x = document.getElementById(`ipt_${x}`);
            texto_x.style.color = "#DEA976";
            texto_x.style.position = "relative";
            texto_x.style.transform = "translate(-2vw, -3.2vh)";
            texto_x.style.transition = "0.7s ease-in-out";
            ipt_x.style.borderBottom = "solid 3px #DEA976;";
        }
        function proximaEtapa() {
            var primeiro = document.querySelector('.primeiro')
            var segundo = document.querySelector('.segundo')
            primeiro.style.display = "none"
            segundo.style.display = "flex"
        }


        function digitando_senha() {
            // Verificação dos requisitos da senha
            var senha = ipt_senha.value;
            var especiais = "!#$%&'()*+,-:;<=>?@[]^_`{|}~´`^~¨§ªº°";

            let temMaiusculo = false, temMinusculo = false, temNumero = false, temEspecial = false;

            for (let i = 0; i < senha.length; i++) {
                var c = senha[i];
                if (c >= 'A' && c <= 'Z') temMaiusculo = true;
                if (c >= 'a' && c <= 'z') temMinusculo = true;
                if (!isNaN(c)) temNumero = true;
                if (especiais.includes(c)) temEspecial = true;
            }

            maiusculo.style.color = temMaiusculo ? "#DEA976" : "grey";
            minusculo.style.color = temMinusculo ? "#DEA976" : "grey";
            numero.style.color = temNumero ? "#DEA976" : "grey";
            especial.style.color = temEspecial ? "#DEA976" : "grey";
            minimo.style.color = senha.length >= 8 ? "#DEA976" : "grey";
        }

        function cadastrar() {
                        // falta atualizar
            var nome_fantasia = document.getElementById('ipt_nome_fantasia').value
            var razao_social = document.getElementById('ipt_razao_social').value
            var cnpj = document.getElementById('ipt_cnpj').value;


            var nome = document.getElementById('ipt_nome').value;
            var email = document.getElementById('ipt_email').value;
            var telefone = document.getElementById('ipt_telefone').value;
            var senha = document.getElementById('ipt_senha').value;
            var confirmarsenha = document.getElementById('ipt_confirmar_senha').value;



            var nome_fantasia = document.getElementById('ipt_nome_fantasia').value
            var nome_fantasia = document.getElementById('ipt_nome_fantasia').value
             
            var validado = true;
            var experimento = true
            // Mensagens de erro
            var nome_erro = document.getElementById('erro_nome');
            var cnpj_erro = document.getElementById('erro_cnpj');
            var email_erro = document.getElementById('erro_email');
            var senha_erro = document.getElementById('erro_senha');
            var conf_senha_erro = document.getElementById('erro_confirmar_senha');

            // Verificar campos vazios
            if (nome == "" || cnpj == "" || email == "" || senha == "" || confirmarsenha == "") {
                campos_vazios.style = "display: flex";
                validado = false;
            }

            // Nome de usuário
            if (nome === "") {
                nome_erro.innerHTML = 'Preencha o nome de usuário';
                nome_erro.style = "display: flex";
                validado = false;
            } else if (nome.length < 3) {
                nome_erro.innerHTML = 'Erro... Não pode ter menos de 3 caracteres no usuário';
                nome_erro.style = "display: flex";
                validado = false;
            }

            // Validação do CNPJ
            const cnpjHasLetters = /[a-zA-Z]/.test(cnpj);
            const cnpjHasSpecials = /[^0-9]/.test(cnpj);
            if (cnpj.length !== 14 || cnpjHasLetters || cnpjHasSpecials) {
                cnpj_erro.innerHTML = 'CNPJ deve ter 14 números e não conter letras ou símbolos.';
                cnpj_erro.style.display = "flex";
                validado = false;
            }

            // Validação do e-mail
            const arrobas = [...email].filter(c => c === '@').length;
            if (!email.includes('@') || arrobas > 1 || !email.endsWith('.com') || email.includes(' ')) {
                email_erro.innerHTML = 'Email inválido. Ex: exemplo@gmail.com';
                email_erro.style.display = "flex";
                validado = false;
            }

            // Validação da senha
            const especiais = "!#$%&'()*+,-:;<=>?@[]^_`{|}~´`^~¨§ªº°";
            let temMaiusculo = false, temMinusculo = false, temNumero = false, temEspecial = false;

            for (let i = 0; i < senha.length; i++) {
                const c = senha[i];
                if (c >= 'A' && c <= 'Z') temMaiusculo = true;
                if (c >= 'a' && c <= 'z') temMinusculo = true;
                if (!isNaN(c)) temNumero = true;
                if (especiais.includes(c)) temEspecial = true;
            }

            if (!temMaiusculo || !temMinusculo || !temNumero || !temEspecial || senha.length < 8) {
                senha_erro.innerHTML = 'Senha deve conter: 1 maiúscula, 1 minúscula, 1 número, 1 símbolo e mínimo 8 caracteres.';
                senha_erro.style.display = "flex";
                validado = false;
            }

          /*  // Confirmar senha
            if (senha != confirmarsenha) {
                conf_senha_erro.innerHTML = "As senhas não coincidem.";
                conf_senha_erro.style.display = "flex";
                validado = false;
            }*/

            // Se tudo estiver validado, prossiga com o cadastro
            if (validado) {
                // Lógica para cadastrar o usuário
                // Limpeza dos campos (se necessário)
                // Limpeza de erros
                nome_erro.style.display = "none";
                cnpj_erro.style.display = "none";
                email_erro.style.display = "none";
                senha_erro.style.display = "none";
                conf_senha_erro.style.display = "none";
                campos_vazios.style.display = "none";
            }
              if (experimento) {
                    fetch("/usuarios/cadastrar_vinicola", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({

                            nomeFantasiaServer: nome,
                            razaoSocialServer: cnpj,
                            cnpjServer: cnpj,

                            nomeServer: nome,
                            telefoneServer: telefone,
                            emailServer: email,
                            senhaServer: senha,
                        }),
                    })
                        .then(function (resposta) {
                            console.log("resposta: ", resposta);

                            if (resposta.ok) {
                                alert('redirecionando')

                                
                                setTimeout(() => {
                                    window.location = "login.html";
                                }, "2000");

                            } else {
                                throw "Houve um erro ao tentar realizar o cadastro!";
                            }
                        })
                        .catch(function (resposta) {
                            console.log(`#ERRO: ${resposta}`);
                            finalizarAguardar();
                        });

                    return false;
                }
        }

        function fechar_alerta() {
            alerta_grupo3.style = "display:none"
            div_fechar_alerta.style = "display:none"
        }

    </script>